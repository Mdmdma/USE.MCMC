<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Insights on Markov chain based pseudo-absence sampling ‚Ä¢ USE.MCMC</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Insights on Markov chain based pseudo-absence sampling">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">USE.MCMC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/development_vignette.html">Development Vignette</a></li>
    <li><a class="dropdown-item" href="../articles/insights-on-MCMC-pseudo-absence-sampling-vignette.html">Insights on Markov chain based pseudo-absence sampling</a></li>
    <li><a class="dropdown-item" href="../articles/Insights-on-nearest-neighbor-search.html">Insights on nearest neighbor search</a></li>
    <li><a class="dropdown-item" href="../articles/USE_vignette.html">USE vignette</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/mdmdma/USE.MCMC/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Insights on Markov chain based pseudo-absence sampling</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mdmdma/USE.MCMC/blob/main/vignettes/insights-on-MCMC-pseudo-absence-sampling-vignette.Rmd" class="external-link"><code>vignettes/insights-on-MCMC-pseudo-absence-sampling-vignette.Rmd</code></a></small>
      <div class="d-none name"><code>insights-on-MCMC-pseudo-absence-sampling-vignette.Rmd</code></div>
    </div>

    
    
<p>This vignette gives insights into how MCMC works and how it can be
used to sample pseudo-absences. It builds on the idea of nearest
neighbor mapping. This concept is explained in detail in the <a href="Insights-on-nearest-neighbor-search.html">insights on nearest
neighbor search</a>.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mdmdma.github.io/USE.MCMC/">USE.MCMC</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://borisleroy.com/virtualspecies/" class="external-link">virtualspecies</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">parallel</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">FNN</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">coda</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com" class="external-link">gganimate</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">tcltk</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: no DISPLAY variable so Tk is not available</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wilkelab.org/cowplot/" class="external-link">cowplot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://strimmerlab.github.io/software/entropy/" class="external-link">entropy</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">40</span><span class="op">)</span></span></code></pre></div>
<p>Before we can understand why Markov chains are useful, we have to
understand how they work.</p>
<p>For our use-case, Markov chains can be understood as a random walk.
From a given starting point the chain starts to explore the given space.
Given the current point, we calculate the update step. In this case,
this step is two dimensional Gaussian noise. The algorithm then decides
if it wants to accept this proposed point. In this first example we
accept all points.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">starting.point</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>x<span class="op">=</span><span class="fl">0</span>, y<span class="op">=</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="va">sampled.points</span> <span class="op">&lt;-</span> <span class="fu">USE.MCMC</span><span class="fu">::</span><span class="fu"><a href="../reference/mcmcSampling.html">mcmcSampling</a></span><span class="op">(</span>dataset<span class="op">=</span><span class="va">starting.point</span>,</span>
<span>                               dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>,</span>
<span>                               densityFunction <span class="op">=</span> <span class="va">alwaysOne</span>,</span>
<span>                               proposalFunction <span class="op">=</span> <span class="fu"><a href="../reference/addHighDimGaussian.html">addHighDimGaussian</a></span><span class="op">(</span>dim<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                               burnIn <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                               covariance.correction <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                               n.sample.points <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                               verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="gif_example_chain.gif"></p>
<p>In practical cases a Markov chain does not perform a completely
random walk. The chain tries to replicate some kind of target function.
In the case above this function is one everywhere. Therefore the chain
explores in all directions and without limit. In this unbounded case the
chain does not converge to a stationary state.</p>
<p>In a real use case we want to generate samples from a target density.
We can supply the MCMC algorithm with this function that represents the
distribution we want to replicate.</p>
<p>Lets make an example and create samples from a two dimensional
Gaussian.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">densityFunctionGaussian</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">point</span>, <span class="va">lengthscale</span><span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">density</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="op">-</span><span class="op">(</span><span class="va">point</span><span class="op">$</span><span class="va">x</span> <span class="op">**</span> <span class="fl">2</span> <span class="op">+</span> <span class="va">point</span><span class="op">$</span><span class="va">y</span> <span class="op">**</span> <span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="va">lengthscale</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu">densityFunctionGaussian</span><span class="op">(</span><span class="va">sampled.points</span><span class="op">)</span></span>
<span><span class="va">sampled.points.gaussian</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmcSampling.html">mcmcSampling</a></span><span class="op">(</span>dataset<span class="op">=</span><span class="va">starting.point</span>,</span>
<span>                                  dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>,</span>
<span>                                  densityFunction <span class="op">=</span> <span class="va">densityFunctionGaussian</span>,</span>
<span>                                  proposalFunction <span class="op">=</span> <span class="fu"><a href="../reference/addHighDimGaussian.html">addHighDimGaussian</a></span><span class="op">(</span>dim<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                                  burnIn <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                                  covariance.correction <span class="op">=</span> <span class="fl">13</span>,</span>
<span>                                  n.sample.points <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The further the chain wanders away from the origin the higher the
probability gets that the proposed point gets rejected.</p>
<p><img src="gif_example_chain_gaussian.gif"> As before the proposal
step is completely random. The algorithm now decides if it wants to
accept the proposed next point using the Metropolis‚ÄìHastings algorithm.
$$</p>
= , p_{n+1} =
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mi>p</mi><mi>‚Ä≤</mi></mtd><mtd columnalign="left" style="text-align: left"><mi>Œ±</mi><mo>&gt;</mo><mi>n</mi><mo>,</mo><mi>n</mi><mo>‚àº</mo><mi>ùí∞</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><msub><mi>p</mi><mi>n</mi></msub></mtd><mtd columnalign="left" style="text-align: left"><mtext mathvariant="normal">otherwise</mtext></mtd></mtr></mtable></mrow><annotation encoding="application/x-tex">\begin{cases}
        p' &amp; \alpha &gt;n, n\sim \mathcal{U}(0,1)  \\
        p_n &amp; \text{otherwise}
    \end{cases}</annotation></semantics></math><p>$$ Given a point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>p</mi><mi>n</mi></msub><annotation encoding="application/x-tex">p_n</annotation></semantics></math>
we calculate a proposed point
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>p</mi><mi>‚Ä≤</mi></mrow><annotation encoding="application/x-tex">p'</annotation></semantics></math>.
The function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">d(p)</annotation></semantics></math>
guides our chain. If the value of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>p</mi><mi>‚Ä≤</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">d(p')</annotation></semantics></math>
is higher at the new location, the chain always continues. If the value
of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>d</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">d(p)</annotation></semantics></math>
is lower at the new location the chain sometimes transitions. This
guarantees that the whole space is eventually sampled. This assumption
only holds up if we sample for enough steps and the sampled function is
compact, in addition to probably other things.</p>
<p>Looking at the posterior of our sampled points, the distribution of x
and y values of our points, we see that they resemble Gaussian, but our
sample size was too small.
<img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/gaussian-posterior-plot-1.png" class="r-plt" alt="" width="672">
Increasing the sample size results in a better approximation.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampled.points.gaussian</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmcSampling.html">mcmcSampling</a></span><span class="op">(</span>dataset<span class="op">=</span><span class="va">starting.point</span>,</span>
<span>                                  dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>,</span>
<span>                                  densityFunction <span class="op">=</span> <span class="va">densityFunctionGaussian</span>,</span>
<span>                                  proposalFunction <span class="op">=</span> <span class="fu"><a href="../reference/addHighDimGaussian.html">addHighDimGaussian</a></span><span class="op">(</span>dim<span class="op">=</span><span class="fl">2</span><span class="op">)</span>,</span>
<span>                                  burnIn <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>                                  n.sample.points <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>                                  verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Burn in skipped</span></span>
<span><span class="co">#&gt; The final covariance correction is  1 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Points rejected:  2994</span></span></code></pre></div>
<p><img src="gif_example_chain_gaussian_long.gif"><img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/gaussian-posterior-plot-more-samples-1.png" class="r-plt" alt="" width="672"></p>
<p>In this low dimensional case with a simple function there are more
simple ways to generate samples. The case where MCMC gets useful for
sample generation is if the function is very complicated and expensive
to compute and in case our problem lives in high dimensions.</p>
<p>Lets explore the dimensionality issue first. If we compute the value
of our function on a grid with 100 cells per dimension‚Äîa moderate
resolution‚Äîthis results in 10,000 points in the two-dimensional case. In
the five-dimensional case, this results in 10 billion points.
Computational and memory requirements become limiting factors for
application of such approaches.</p>
<p>In case of MCMC sampling the computational complexity increases, but
less fast. The function that we have to evaluate to decide if we want to
accept a new point becomes more complex and we have to run the chain for
longer until we have good convergence.</p>
<div class="section level2">
<h2 id="pseudo-absence-sampling">pseudo-absence sampling<a class="anchor" aria-label="anchor" href="#pseudo-absence-sampling"></a>
</h2>
<p>If we want to use MCMC to generate pseudo-absences we first have to
construct the function that represents the density of our
pseudo-absences in the environmental space.</p>
<p>Here we demonstrate an approach using Gaussian mixtures. As the
example above shows we can generate sample points from a Gaussian
distribution.We can also use sample points to find the Gaussian that
explains the given data best. In a Gaussian mixture model we do not only
fit one Gaussian, but can find the number of Gaussian that approximates
the given point distribution.</p>
<p>For the Gaussian mixture model to fit the data well it has to
resemble a multi-modal Gaussian. The environment does not necessarily
have this structure. We therefore perform a PCA to have a more simple
structure in our data and reduce its dimensionality.</p>
<p>In a first step, we have to decide which dimensions we want to sample
uniformly.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dimensions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PC1"</span>, <span class="st">"PC2"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env.data.raster</span> <span class="op">&lt;-</span> <span class="fu">USE.MCMC</span><span class="fu">::</span><span class="va"><a href="../reference/Worldclim_tmp.html">Worldclim_tmp</a></span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>type<span class="op">=</span><span class="st">"xyz"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/math-generics.html" class="external-link">round</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">rpc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rastPCA.html">rastPCA</a></span><span class="op">(</span><span class="va">env.data.raster</span>,  stand <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">env.data.raster.with.pc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">env.data.raster</span>, <span class="va">rpc</span><span class="op">$</span><span class="va">PCs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">env.data.sf</span> <span class="op">&lt;-</span> <span class="va">env.data.raster</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Attaching the data in the PCA coordinates</span></span>
<span><span class="va">env.with.pc.sf</span> <span class="op">&lt;-</span> <span class="va">rpc</span><span class="op">$</span><span class="va">PCs</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/na.omit.html" class="external-link">na.omit</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_join</a></span><span class="op">(</span><span class="va">env.data.sf</span><span class="op">)</span></span>
<span></span>
<span><span class="va">env.data.cleaned</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">env.with.pc.sf</span><span class="op">[</span><span class="va">dimensions</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>To generate pseudo-absences we use two Gaussian mixture models. In a
first step we fit the points in our environment. This part of the model
is later used to stop our chain from wandering into areas outside our
environment.</p>
<p><img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/plot-env-data-1.png" class="r-plt" alt="" width="672"></p>
<p>We subsample the environment to speed up the computation. As fitting
Gaussian mixtures is a statistical process and the dataset is still
large this is justified. In addition to that this model is only used to
keep the chain in bound. Other techniques are later used to exclude
parts of the chain that are too far from the real data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env.with.pc.sf.subsampled</span> <span class="op">&lt;-</span> <span class="va">env.with.pc.sf</span><span class="op">[</span></span>
<span>  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">env.with.pc.sf</span><span class="op">)</span>, <span class="fl">2000</span><span class="op">)</span> , <span class="fl">1</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">env.with.pc.sf</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span>
<span><span class="va">env.data.cleaned.subsampled</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span></span>
<span>  <span class="va">env.with.pc.sf.subsampled</span><span class="op">[</span><span class="va">dimensions</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">environmental.data.model</span> <span class="op">&lt;-</span> <span class="fu">mclust</span><span class="fu">::</span><span class="fu"><a href="https://mclust-org.github.io/mclust/reference/densityMclust.html" class="external-link">densityMclust</a></span><span class="op">(</span><span class="va">env.data.cleaned.subsampled</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Gaussian mixture fitted to the environment"</span><span class="op">)</span></span></code></pre></div>
<p><img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/fit-environmental-model-1.png" class="r-plt" alt="" width="672"></p>
<p>The fitted model is a function that gives us the sum of the Gaussian
components at each location. The higher the value the higher the
probably to find a point at the given location. In our case we want to
sample the environmental space uniformly, not reproduce the underlying
distribution. We use this environmental model only to set the boundaries
for our chain.</p>
<p>The model density at the points in the environment can be used to
find the threshold under which no points are expected any more.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">environmental.densities</span> <span class="op">&lt;-</span> <span class="fu">mclust</span><span class="fu">::</span><span class="fu"><a href="https://mclust-org.github.io/mclust/reference/predict.densityMclust.html" class="external-link">predict.densityMclust</a></span><span class="op">(</span></span>
<span>  <span class="va">environmental.data.model</span>, <span class="va">env.data.cleaned</span><span class="op">)</span></span>
<span><span class="va">environmental.threshold</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">environmental.densities</span>, <span class="fl">0.01</span><span class="op">)</span></span></code></pre></div>
<p>We can now start to construct the function that our chain tries to
sample from.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">densityFunctionNaive</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">env.model</span>, <span class="va">env.threshold</span>, <span class="va">dimensions</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">densityFunction</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">point</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">point</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">point</span><span class="op">)</span></span>
<span>    <span class="va">point</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">point</span><span class="op">[</span><span class="va">dimensions</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rspatial.github.io/terra/reference/coerce.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">env.density</span> <span class="op">&lt;-</span> <span class="fu">mclust</span><span class="fu">::</span><span class="fu"><a href="https://mclust-org.github.io/mclust/reference/predict.densityMclust.html" class="external-link">predict.densityMclust</a></span><span class="op">(</span><span class="va">env.model</span>, <span class="va">point</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">env.density</span> <span class="op">&lt;</span> <span class="va">env.threshold</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">densityFunction</span> <span class="op">&lt;-</span> <span class="fu">densityFunctionNaive</span><span class="op">(</span><span class="va">environmental.data.model</span>,</span>
<span>                                        <span class="va">environmental.threshold</span>,</span>
<span>                                        <span class="va">dimensions</span><span class="op">)</span></span></code></pre></div>
<p>As we are in the two dimensional case we can plot the function.</p>
<p><img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/plot-simple-denisty-1.png" class="r-plt" alt="" width="672"></p>
<p>We can now use the Markov chain algorithm from before to generate
samples from this function.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampled.points.naive.density</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmcSampling.html">mcmcSampling</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">env.with.pc.sf</span>,</span>
<span>                                      dimensions <span class="op">=</span> <span class="va">dimensions</span>,</span>
<span>                                      densityFunction <span class="op">=</span> <span class="va">densityFunction</span>,</span>
<span>                                      n.sample.points <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>                                      burnIn <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                      covariance.correction <span class="op">=</span> <span class="fl">13</span><span class="op">)</span></span></code></pre></div>
<p><img src="chain.naive.density.gif"></p>
<p>We can now sample our environmental space uniformly. pseudo-absences
should not only be uniformly distributed but also evade the conditions
under which the species we try to model flourishes. We have to extend
the function from above to reflect that</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">virtual.presence.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/getVirtualSpeciesPresencePoints.html">getVirtualSpeciesPresencePoints</a></span><span class="op">(</span></span>
<span>  env.data <span class="op">=</span> <span class="va">env.data.raster.with.pc</span>, n.samples <span class="op">=</span> <span class="fl">300</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading raster values. If it fails for very large rasters, use arguments 'sample.points = TRUE' and define a number of points to sample with 'nb.point'.</span></span>
<span><span class="co">#&gt;  - Perfoming the pca</span></span>
<span><span class="co">#&gt;  - Defining the response of the species along PCA axes</span></span>
<span><span class="co">#&gt;  - Calculating suitability values</span></span>
<span><span class="co">#&gt;    The final environmental suitability was rescaled between 0 and 1.</span></span>
<span><span class="co">#&gt;                   To disable, set argument rescale = FALSE</span></span>
<span><span class="co">#&gt;    --- Determing species.prevalence automatically according to alpha and beta</span></span>
<span><span class="co">#&gt;    Logistic conversion finished:</span></span>
<span><span class="co">#&gt;               </span></span>
<span><span class="co">#&gt; - beta = 0.55</span></span>
<span><span class="co">#&gt; - alpha = -0.05</span></span>
<span><span class="co">#&gt; - species prevalence =0.453490212631246</span></span>
<span><span class="va">virtual.presence.points</span> <span class="op">&lt;-</span> <span class="va">virtual.presence.data</span><span class="op">$</span><span class="va">sample.points</span></span>
<span><span class="va">virtual.presence.points.pc</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span><span class="va">env.data.raster.with.pc</span>,</span>
<span>                                             <span class="va">virtual.presence.points</span>,</span>
<span>                                             bind <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>As before we can fit a Gaussian mixture to the given data points of
the model species.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species.model</span> <span class="op">=</span> <span class="fu">mclust</span><span class="fu">::</span><span class="fu"><a href="https://mclust-org.github.io/mclust/reference/densityMclust.html" class="external-link">densityMclust</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">virtual.presence.points.pc</span><span class="op">[</span><span class="va">dimensions</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">species.densities</span> <span class="op">&lt;-</span> <span class="va">species.model</span><span class="op">$</span><span class="va">density</span></span>
<span><span class="va">species.cutoff.threshold</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">species.densities</span>, <span class="fl">0.9</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Gaussian mixture model fitted to the target species"</span><span class="op">)</span></span></code></pre></div>
<p><img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/fit-species-model-1.png" class="r-plt" alt="" width="672"></p>
<p>Now we can build a function that describes the distribution of
pseudo-absences. To evade the presence we subtract the value of the
presence model. The value of the presence model can be scaled to tune
how strongly the presence species is avoided. We do this by selecting
the density at a given quantile of the presence points and scale the
whole function so that the value becomes 1. As we subtract it from the
former function value, we now get values below zero in these areas,
meaning we will never visit them with the chain.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">densityFunctionPseudoAbsences</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">env.model</span>, <span class="va">env.threshold</span>,</span>
<span>                                  <span class="va">pres.model</span>, <span class="va">pres.threshold</span>, </span>
<span>                                  <span class="va">dimensions</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">densityFunction</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">point</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">point</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">point</span><span class="op">[</span><span class="va">dimensions</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>      <span class="fu"><a href="https://rspatial.github.io/terra/reference/coerce.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="va">env.density</span> <span class="op">&lt;-</span> <span class="fu">mclust</span><span class="fu">::</span><span class="fu"><a href="https://mclust-org.github.io/mclust/reference/predict.densityMclust.html" class="external-link">predict.densityMclust</a></span><span class="op">(</span><span class="va">env.model</span>, <span class="va">point</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">env.density</span> <span class="op">&lt;</span> <span class="va">env.threshold</span><span class="op">)</span><span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span></span>
<span>        <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">-</span><span class="fu">mclust</span><span class="fu">::</span><span class="fu"><a href="https://mclust-org.github.io/mclust/reference/predict.densityMclust.html" class="external-link">predict.densityMclust</a></span><span class="op">(</span><span class="va">pres.model</span>, <span class="va">point</span><span class="op">)</span> <span class="op">/</span></span>
<span>              <span class="va">pres.threshold</span><span class="op">)</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">densityFunction</span> <span class="op">&lt;-</span> <span class="fu">densityFunctionPseudoAbsences</span><span class="op">(</span><span class="va">environmental.data.model</span>,</span>
<span>                                                 <span class="va">environmental.threshold</span>,</span>
<span>                                                 <span class="va">species.model</span>,</span>
<span>                                                 <span class="va">species.cutoff.threshold</span>,</span>
<span>                                                 <span class="va">dimensions</span><span class="op">)</span></span></code></pre></div>
<p>As before we can plot the function we want to sample from.</p>
<p><img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/plot-pseudo-absence-density-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampled.points.ps.density</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmcSampling.html">mcmcSampling</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">env.with.pc.sf</span>,</span>
<span>                                      dimensions <span class="op">=</span> <span class="va">dimensions</span>,</span>
<span>                                      densityFunction <span class="op">=</span> <span class="va">densityFunction</span>,</span>
<span>                                      n.sample.points <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>                                      burnIn <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                      covariance.correction <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">sampled.points.ps.density</span><span class="op">$</span><span class="va">step</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">sampled.points.ps.density</span><span class="op">)</span></span>
<span><span class="va">p.chain.ps.density</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">sampled.points.ps.density</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC1</span>, y<span class="op">=</span><span class="va">PC2</span>, color<span class="op">=</span><span class="va">step</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_path</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">PC1</span>, y<span class="op">=</span><span class="va">PC2</span>, color<span class="op">=</span><span class="va">step</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Chain on full pseudo-absence model"</span><span class="op">)</span>  <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_color_viridis</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">a.chain.ps.density</span> <span class="op">&lt;-</span> <span class="va">p.chain.ps.density</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/transition_time.html" class="external-link">transition_time</a></span><span class="op">(</span><span class="va">step</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://gganimate.com/reference/ease_aes.html" class="external-link">ease_aes</a></span><span class="op">(</span><span class="st">'linear'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/transition_reveal.html" class="external-link">transition_reveal</a></span><span class="op">(</span><span class="va">step</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/enter_exit.html" class="external-link">exit_shrink</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://gganimate.com/reference/shadow_trail.html" class="external-link">shadow_trail</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gif.chain.ps.density</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/animate.html" class="external-link">animate</a></span><span class="op">(</span><span class="va">a.chain.ps.density</span>, renderer <span class="op">=</span> <span class="fu"><a href="https://gganimate.com/reference/renderers.html" class="external-link">gifski_renderer</a></span><span class="op">(</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">700</span>, height <span class="op">=</span> <span class="fl">400</span>, fps <span class="op">=</span> <span class="fl">10</span>, duration <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://gganimate.com/reference/anim_save.html" class="external-link">anim_save</a></span><span class="op">(</span><span class="st">"chain.ps.density.gif"</span>, <span class="va">gif.chain.ps.density</span><span class="op">)</span></span></code></pre></div>
<p><img src="chain.ps.density.gif"></p>
<p>So far the sample points are real points in the environment. They
only have values for the dimension we wanted to sample. To get real
points again we use the nearest neighbor search. The technique is
further described in <a href="Insights-on-nearest-neighbor-search.html">insights on nearest
neighbor search</a>. The core of the idea is that we can compute the
distance from a sample point to other points in the dataset and choose
the point with the shortest distance to represent our sample point.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampled.points</span> <span class="op">&lt;-</span> <span class="va">sampled.points.ps.density</span></span>
<span><span class="va">mapped.sampled.point.locations</span> <span class="op">&lt;-</span> <span class="fu">FNN</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FNN/man/get.knn.html" class="external-link">get.knnx</a></span><span class="op">(</span></span>
<span>  <span class="va">env.data.cleaned</span><span class="op">[</span><span class="va">dimensions</span><span class="op">]</span>, <span class="va">sampled.points</span><span class="op">[</span><span class="va">dimensions</span><span class="op">]</span>,k <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">mapped.sampled.points</span> <span class="op">&lt;-</span> <span class="va">env.with.pc.sf</span><span class="op">[</span></span>
<span>  <span class="va">mapped.sampled.point.locations</span><span class="op">$</span><span class="va">nn.index</span>,<span class="op">]</span></span>
<span><span class="va">mapped.sampled.points</span><span class="op">$</span><span class="va">density</span> <span class="op">&lt;-</span> <span class="va">sampled.points</span><span class="op">$</span><span class="va">density</span></span>
<span><span class="va">mapped.sampled.points</span><span class="op">$</span><span class="va">distance</span> <span class="op">&lt;-</span> <span class="va">mapped.sampled.point.locations</span><span class="op">$</span><span class="va">nn.dist</span></span></code></pre></div>
<p>Now we have real points in our environment with a geographical
location. The model of our environment is not perfect. The distance to
the remapped point gives an indication on how far the chain wandered off
the real data points. We can use it to filter points that originated in
areas where our environmental model was bad. The distance that lies
between a point and its origin should never be more than half the
maximal distance between points in the dataset.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nearest.neighbors.distance</span><span class="op">&lt;-</span> <span class="fu">FNN</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FNN/man/knn.dist.html" class="external-link">knn.dist</a></span><span class="op">(</span><span class="va">env.data.cleaned</span><span class="op">[</span><span class="va">dimensions</span><span class="op">]</span>,</span>
<span>                                           k<span class="op">=</span><span class="fl">3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/vector.html" class="external-link">as.vector</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sorted.nearest.neighbor.distances</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="va">nearest.neighbors.distance</span>, </span>
<span>                                          decreasing<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">distance.threshold</span> <span class="op">&lt;-</span> <span class="va">sorted.nearest.neighbor.distances</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span><span class="va">mapped.sampled.points.filtered</span> <span class="op">&lt;-</span> <span class="va">mapped.sampled.points</span><span class="op">[</span></span>
<span>  <span class="va">mapped.sampled.points</span><span class="op">$</span><span class="va">distance</span> <span class="op">&lt;</span> <span class="va">distance.threshold</span>, <span class="op">]</span></span></code></pre></div>
<p>In a last step we can select the desired number of points from our
chain.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n.samples</span> <span class="op">&lt;-</span> <span class="fl">300</span></span>
<span><span class="va">mapped.sampled.points.selected</span> <span class="op">&lt;-</span> <span class="va">mapped.sampled.points.filtered</span><span class="op">[</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n.samples</span>, <span class="fl">0</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">mapped.sampled.points.filtered</span><span class="op">)</span><span class="op">)</span>, <span class="op">]</span></span></code></pre></div>
<p>We can look at our points in the environmental space</p>
<p><img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/points-in-the-environment-1.png" class="r-plt" alt="" width="672"></p>
<p>Looking at the posteriors we can see that we managed to sample the
environmental space uniformly.</p>
<p><img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/mcmc-posterior-1.png" class="r-plt" alt="" width="672">
For the selected dimensions the posterior density is flat, for the other
ones, in this case principal component three, the distribution follows
the environment.</p>
<p>The sampled points can also be plotted in the geographical space.
<img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/plot-in-geo-1.png" class="r-plt" alt="" width="672"></p>
<p>So far we did nothing revolutionary. All of the given can be done
using existing techniques.The advantage emerges when we want to increase
the dimensions included. The only thing that has to change is the vector
from the beginning in which we stated the dimensions to include. As the
results are getting difficult to represent in 2d plots, we focus on the
results of such computations.</p>
<p>The function paSamplingMcmc wraps what we did so far in this vignette
into one single concise function to efficiently create
pseudo-absences.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># One core is used for rendering the vignette, for interactive use this can be set higher</span></span>
<span><span class="va">sampled.points.mcmc.higher.dim</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/paSamplingMcmc.html">paSamplingMcmc</a></span><span class="op">(</span>env.data.raster <span class="op">=</span> <span class="va">env.data.raster</span>,</span>
<span>                                      pres <span class="op">=</span> <span class="va">virtual.presence.points</span>,</span>
<span>                                      precomputed.pca <span class="op">=</span> <span class="va">rpc</span>,</span>
<span>                                      environmental.cutof.percentile <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>                                      num.chains <span class="op">=</span> <span class="fl">4</span>,</span>
<span>                                      num.cores <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                      chain.length <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>                                      n.samples <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                                      covariance.correction <span class="op">=</span> <span class="fl">70</span>,</span>
<span>                                      verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                      dimensions <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>By including the third dimension into the algorithm we now get a flat
posterior density also for it.</p>
<p><img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/plot-3d-1.png" class="r-plt" alt="" width="672">
# Conververnce A topic not cover so far is convergence. The reason why
we use MCMC is to reduce computational complexity of our problem.
Therefore we have to know how long we have to run the algorithm and how
many chains we should combine to get satisfying results.</p>
<p>To evaluate these issues let‚Äôs first generate some long chains.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dimensions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PC1"</span>, <span class="st">"PC2"</span>, <span class="st">"PC3"</span><span class="op">)</span></span>
<span><span class="co"># Environmental model in 3 dimensions</span></span>
<span><span class="va">env.with.pc.sf.subsampled</span> <span class="op">&lt;-</span> <span class="va">env.with.pc.sf</span><span class="op">[</span></span>
<span>  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">env.with.pc.sf</span><span class="op">)</span>, <span class="fl">2000</span><span class="op">)</span> , <span class="fl">1</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">env.with.pc.sf</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">env.data.cleaned.subsampled</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span></span>
<span>  <span class="va">env.with.pc.sf.subsampled</span><span class="op">[</span><span class="va">dimensions</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">environmental.data.model</span> <span class="op">&lt;-</span> <span class="fu">mclust</span><span class="fu">::</span><span class="fu"><a href="https://mclust-org.github.io/mclust/reference/densityMclust.html" class="external-link">densityMclust</a></span><span class="op">(</span><span class="va">env.data.cleaned.subsampled</span><span class="op">)</span></span></code></pre></div>
<p><img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/highe-dim-convergence-1.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">env.data.cleaned</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">env.with.pc.sf</span><span class="op">[</span><span class="va">dimensions</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">environmental.densities</span> <span class="op">&lt;-</span> <span class="fu">mclust</span><span class="fu">::</span><span class="fu"><a href="https://mclust-org.github.io/mclust/reference/predict.densityMclust.html" class="external-link">predict.densityMclust</a></span><span class="op">(</span></span>
<span>  <span class="va">environmental.data.model</span>, <span class="va">env.data.cleaned</span><span class="op">)</span></span>
<span><span class="va">environmental.threshold</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">environmental.densities</span>, <span class="fl">0.04</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#species model in 3 dimensions</span></span>
<span><span class="va">species.model</span> <span class="op">=</span> <span class="fu">mclust</span><span class="fu">::</span><span class="fu"><a href="https://mclust-org.github.io/mclust/reference/densityMclust.html" class="external-link">densityMclust</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">virtual.presence.points.pc</span><span class="op">[</span><span class="va">dimensions</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/highe-dim-convergence-2.png" class="r-plt" alt="" width="672"></p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">species.densities</span> <span class="op">&lt;-</span> <span class="va">species.model</span><span class="op">$</span><span class="va">density</span></span>
<span><span class="va">species.cutoff.threshold</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/quantile.html" class="external-link">quantile</a></span><span class="op">(</span><span class="va">species.densities</span>, <span class="fl">0.9</span><span class="op">)</span></span>
<span></span>
<span><span class="va">covariance.scaling</span> <span class="op">&lt;-</span><span class="fl">0.075</span></span>
<span><span class="va">covariance.matrix</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/cor.html" class="external-link">cov</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span><span class="va">env.with.pc.sf</span><span class="op">)</span><span class="op">[</span><span class="va">dimensions</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">proposalFunction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/addHighDimGaussian.html">addHighDimGaussian</a></span><span class="op">(</span>cov.mat <span class="op">=</span><span class="va">covariance.scaling</span> <span class="op">*</span> <span class="va">covariance.matrix</span>,</span>
<span>                                       dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">dimensions</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">densityFunction</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mclustDensityFunction.html">mclustDensityFunction</a></span><span class="op">(</span>env.model <span class="op">=</span> <span class="va">environmental.data.model</span>,</span>
<span>                                         species.model <span class="op">=</span> <span class="va">species.model</span>,</span>
<span>                                         dim <span class="op">=</span> <span class="va">dimensions</span>,</span>
<span>                                         threshold <span class="op">=</span> <span class="va">environmental.threshold</span>,</span>
<span>                                         species.cutoff.threshold <span class="op">=</span> <span class="va">species.cutoff.threshold</span><span class="op">)</span></span>
<span></span>
<span><span class="va">chain.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">chain.list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/parallel/mclapply.html" class="external-link">mclapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/capture.output.html" class="external-link">capture.output</a></span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">sampled.points</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mcmcSampling.html">mcmcSampling</a></span><span class="op">(</span>dataset <span class="op">=</span> <span class="va">env.with.pc.sf.subsampled</span>,</span>
<span>                                   dimensions <span class="op">=</span> <span class="va">dimensions</span>,</span>
<span>                                   n.sample.points <span class="op">=</span> <span class="fl">5000</span>,</span>
<span>                                   densityFunction <span class="op">=</span> <span class="va">densityFunction</span>,</span>
<span>                                   proposalFunction <span class="op">=</span> <span class="va">proposalFunction</span>,</span>
<span>                                   burnIn <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                   covariance.correction <span class="op">=</span> <span class="fl">50</span>,</span>
<span>                                   verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="va">chain.list</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.html" class="external-link">as.mcmc</a></span><span class="op">(</span><span class="va">sampled.points</span><span class="op">[</span><span class="va">dimensions</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="op">}</span>, mc.cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">coda.chain.list</span> <span class="op">&lt;-</span> <span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/mcmc.list.html" class="external-link">mcmc.list</a></span><span class="op">(</span><span class="va">chain.list</span><span class="op">)</span></span></code></pre></div>
<p>We can now look at the Gelman-Rubin plot of the chain ensemble. For
the second and third principle component convergence is reached, looking
at the first principle component it seems like the chain should run for
longer. The needed runtime depends on how complex the environmental
space is and on the number of dimensions included.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">coda</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/coda/man/gelman.plot.html" class="external-link">gelman.plot</a></span><span class="op">(</span><span class="va">coda.chain.list</span><span class="op">)</span></span></code></pre></div>
<p><img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/gelman-plot-1.png" class="r-plt" alt="" width="672">
Entropy is a measure for information. The higher the entropy, the more
information a dataset contains. We can plot how the entropy of a chain
evolves over time
<img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/entropy-plot-1.png" class="r-plt" alt="" width="672">
The entropy stabilizes and is similar, indicating that they are well
mixed. Looking at the autocorrelation we get an insight of how much
thinning we have to do if we want the assumption of independently
sampled points should hold. After a lag of around 30 the autocorrelation
stays within the bounds of the long-running range.</p>
<p><img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/autocorreltation-plot-1.png" class="r-plt" alt="" width="672">
We can now compare our newly introduced method to other sampling
approaches. Here we compare it to other approaches that sample uniformly
in the environmental space. We see that if we only use uniform sampling
on two dimensions, the new method performs as the old methods, if we
extend the sampling to 3 dimensions, we also sample the third dimension
uniformly. This comes at the cost of having less uniform sampling along
the first two dimensions. While looking like an issue, it probably
represents more uniform samples, as we want to sample the environmental
volume uniformly, not the single components them self. If component
three has a large range at pc1 = 1, we expect the density of pc1 to be
higher at pc1 = 1</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampled.points.uniform.p</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/paSampling.html">paSampling</a></span><span class="op">(</span>env.rast <span class="op">=</span> <span class="va">env.data.raster</span>,</span>
<span>                                       pres <span class="op">=</span> <span class="va">virtual.presence.points</span>, </span>
<span>                                       grid.res <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">sampled.points.uniform.p.location</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_drop_geometry</a></span><span class="op">(</span></span>
<span>  <span class="va">sampled.points.uniform.p</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sampled.points.uniform.paper</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">extract</a></span><span class="op">(</span></span>
<span>  <span class="va">env.data.raster.with.pc</span>, </span>
<span>  <span class="va">sampled.points.uniform.p.location</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n.sample.points</span> <span class="op">&lt;-</span> <span class="fl">300</span></span>
<span><span class="va">sampled.points.uniform.nn</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/paSamplingNn.html">paSamplingNn</a></span><span class="op">(</span>env.rast <span class="op">=</span> <span class="va">env.data.raster</span>,</span>
<span>                                          pres <span class="op">=</span> <span class="va">virtual.presence.points</span>,</span>
<span>                                          grid.res <span class="op">=</span> <span class="fl">15</span>, n.tr <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                          n.samples <span class="op">=</span> <span class="va">n.sample.points</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampled.points.random.geo</span> <span class="op">&lt;-</span> <span class="va">env.with.pc.sf</span><span class="op">[</span></span>
<span>  <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">env.with.pc.sf</span><span class="op">)</span>, <span class="va">n.sample.points</span><span class="op">)</span> , <span class="fl">1</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">env.with.pc.sf</span><span class="op">)</span><span class="op">)</span>,<span class="op">]</span></span></code></pre></div>
<p><img src="insights-on-MCMC-pseudo-absence-sampling-vignette_files/figure-html/generate-combined-plot-1.png" class="r-plt" alt="" width="672"></p>
</div>
  </main>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Mathis Erler, Daniele Da Re, Enrico Tordoni, Manuele Bazzichetto.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
